{"mappings":"iDAEA,MAAMA,EAAmB,CACvBC,MAAO,KACPC,OAAQ,eAGDC,IACPC,aAAaC,WAAW,YACxBC,OAAOC,SAASC,wBASHC,EAAqBC,GAClC,aAAaC,UAAUC,aAAaC,aAAa,CAC/CC,MAAO,IAAKd,EAAkBU,SAAU,CAAEK,MAAOL,qBAqBtCM,IACb,MACMC,SADmBN,UAAUC,aAAaM,oBAChBC,QAAQC,GAAiB,eAAXA,EAAEC,OAC1CC,EAAWC,SAASC,eACxB,wBAEKF,EAASG,SAASC,OAAS,GAChCJ,EAASK,YAAYL,EAASG,SAASH,EAASG,SAASC,SAE3DE,QAAQC,IAAIZ,GACZ,IAAK,IAAIa,KAAeb,EAAc,CACpC,MAAMc,EAASR,SAASS,cAAc,UACtCD,EAAOE,MAAQH,EAAYpB,SAC3BqB,EAAOG,UAAS,GAAMJ,EAAYK,UAAUL,EAAYpB,YACxDY,EAASc,YAAYL,GAEvB,MAAMM,EAAqBd,SAASC,eAClC,wBAIF,OAFAa,EAAmBC,UAAW,EAEvB,IAAIC,SAAO,CAAeC,EAASC,KACxCJ,EAAmBK,QAAOC,UACxB,IACE,MAAMC,QAAenC,EAAqBa,EAASW,OACnDI,EAAmBC,UAAW,EAC9BD,EAAmBK,QAAU,KAC7BF,WAxDeI,GACrB,MAAMlC,EAAWkC,EAAOC,iBAAiB,GAAGC,cAAcpC,SAE1D,OADAN,aAAa2C,QAAQ,WAAYrC,GAC1BkC,EAqDOI,CAAcJ,IACtB,MAAOK,GACPC,MACE,mEAEFtB,QAAQC,IAAIoB,GACZR,EAAOQ,QA4BfE,YClGgBC,GACd,GAAwB,oBAAb7B,SACT,MAAM,IAAI8B,MAAM,2CAElB,IAAIC,EAAQ/B,SAASgC,WACrB,GAAc,aAAVD,GAAkC,gBAAVA,EAC1B,OAAOE,WAAWJ,EAAU,GAG9B7B,SAASkC,iBAAiB,oBAAoB,WAC5CL,SDwFJ,0CArB8B7B,SAASC,eAAe,mBAChCkB,QAAUvC,EAIxBuD,GACN,IACE,MAAMd,yBA/DR,MAAMe,EAAiBvD,aAAawD,QAAQ,YAC5C,GAAuB,OAAnBD,EAWF,aAAa3C,IAVb,IACE,aAAaP,EAAqBkD,GAClC,MAAOV,GACP,GAAIA,aAAeY,qBACjB,aAAa7C,IAEb,MAAMiC,GAuDWa,GACfC,EAAWxC,SAASC,eACxB,gBAEFI,QAAQC,IAAIe,GACZmB,EAASC,UAAYpB,EACrBhB,QAAQC,IAAI,0BACZ,MAAOoB,GACPrB,QAAQC,IAAIoB,GACZrB,QAAQC,IAAI,wBACZ2B,YAAU,IAAOlD,OAAOC,SAASC,UAAU","sources":["src/ts/main.ts","node_modules/document-ready/index.js"],"sourcesContent":["import ready from 'document-ready';\n\nconst videoConstraints = {\n  width: 1920,\n  height: 1080,\n};\n\nfunction clearDeviceIdAndReload() {\n  localStorage.removeItem('deviceId');\n  window.location.reload();\n}\n\nfunction storeCameraId(stream: MediaStream) {\n  const deviceId = stream.getVideoTracks()[0].getSettings().deviceId;\n  localStorage.setItem('deviceId', deviceId);\n  return stream;\n}\n\nasync function getCameraStreamForId(deviceId) {\n  return await navigator.mediaDevices.getUserMedia({\n    video: { ...videoConstraints, deviceId: { exact: deviceId } },\n  });\n}\n\nasync function getCameraStream() {\n  const storedDeviceId = localStorage.getItem('deviceId');\n  if (storedDeviceId !== null) {\n    try {\n      return await getCameraStreamForId(storedDeviceId);\n    } catch (err) {\n      if (err instanceof OverconstrainedError) {\n        return await selectCamera();\n      } else {\n        throw err;\n      }\n    }\n  } else {\n    return await selectCamera();\n  }\n}\n\nasync function selectCamera() {\n  const allDevices = await navigator.mediaDevices.enumerateDevices();\n  const videoDevices = allDevices.filter((d) => d.kind === 'videoinput');\n  const selector = document.getElementById(\n    'camera-selector'\n  ) as HTMLSelectElement;\n  while (selector.children.length > 0) {\n    selector.removeChild(selector.children[selector.children.length]);\n  }\n  console.log(videoDevices);\n  for (let videoDevice of videoDevices) {\n    const option = document.createElement('option');\n    option.value = videoDevice.deviceId;\n    option.innerText = `${videoDevice.label} (${videoDevice.deviceId})`;\n    selector.appendChild(option);\n  }\n  const accessCameraButton = document.getElementById(\n    'access-camera-button'\n  ) as HTMLButtonElement;\n  accessCameraButton.disabled = false;\n\n  return new Promise<MediaStream>((resolve, reject) => {\n    accessCameraButton.onclick = async () => {\n      try {\n        const stream = await getCameraStreamForId(selector.value);\n        accessCameraButton.disabled = true;\n        accessCameraButton.onclick = null;\n        resolve(storeCameraId(stream));\n      } catch (err) {\n        alert(\n          'Could acquire camera. Please check the console log for details.'\n        );\n        console.log(err);\n        reject(err);\n      }\n    };\n  });\n}\n\nasync function buildConfigUI() {\n  const clearDeviceIdButton = document.getElementById('clear-device-id');\n  clearDeviceIdButton.onclick = clearDeviceIdAndReload;\n}\n\nasync function main() {\n  await buildConfigUI();\n  try {\n    const stream = await getCameraStream();\n    const videoTag = document.getElementById(\n      'camera-video'\n    ) as HTMLVideoElement;\n    console.log(stream);\n    videoTag.srcObject = stream;\n    console.log('Camera access granted.');\n  } catch (err) {\n    console.log(err);\n    console.log('Trying again in 10s.');\n    setTimeout(() => window.location.reload(), 10 * 1000);\n  }\n}\n\nready(main);\n","'use strict'\n\nmodule.exports = ready\n\nfunction ready (callback) {\n  if (typeof document === 'undefined') {\n    throw new Error('document-ready only runs in the browser')\n  }\n  var state = document.readyState\n  if (state === 'complete' || state === 'interactive') {\n    return setTimeout(callback, 0)\n  }\n\n  document.addEventListener('DOMContentLoaded', function onLoad () {\n    callback()\n  })\n}\n"],"names":["$41ab20a3413c0e1b$var$videoConstraints","width","height","$41ab20a3413c0e1b$var$clearDeviceIdAndReload","localStorage","removeItem","window","location","reload","$41ab20a3413c0e1b$var$getCameraStreamForId","deviceId","navigator","mediaDevices","getUserMedia","video","exact","$41ab20a3413c0e1b$var$selectCamera","videoDevices","enumerateDevices","filter","d","kind","selector","document","getElementById","children","length","removeChild","console","log","videoDevice","option","createElement","value","innerText","label","appendChild","accessCameraButton","disabled","Promise","resolve","reject","onclick","async","stream","getVideoTracks","getSettings","setItem","$41ab20a3413c0e1b$var$storeCameraId","err","alert","$parcel$interopDefault","callback","Error","state","readyState","setTimeout","addEventListener","$41ab20a3413c0e1b$var$buildConfigUI","storedDeviceId","getItem","OverconstrainedError","$41ab20a3413c0e1b$var$getCameraStream","videoTag","srcObject"],"version":3,"file":"index.c5254c6d.js.map"}